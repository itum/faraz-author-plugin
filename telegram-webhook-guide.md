# راهنمای تنظیم وب‌هوک تلگرام - افزونه فراز

## معرفی

این افزونه حالا از دو نوع هاست پشتیبانی می‌کند:

### 🌍 هاست خارجی (پیش‌فرض)
- اتصال مستقیم به API تلگرام
- سرعت بالاتر
- برای سرورهای خارج از ایران

### 🇮🇷 هاست ایرانی
- استفاده از پروکسی برای دور زدن فیلتر
- مناسب برای سرورهای داخل ایران
- امکان تنظیم آدرس پروکسی سفارشی

## نحوه تنظیم

### گام 1: انتخاب نوع هاست
1. به بخش **نویسنده خودکار هوشمند > Telegram Webhook** بروید
2. نوع هاست خود را انتخاب کنید:
   - **هاست خارجی**: اگر سرور شما خارج از ایران است
   - **هاست ایرانی**: اگر سرور شما در ایران است

### گام 2: تنظیم پروکسی (فقط برای هاست ایرانی)
اگر هاست ایرانی را انتخاب کردید، دو فیلد نمایش داده می‌شود:

#### 📤 آدرس پروکسی ارسال
- برای ارسال پیام‌های خروجی به تلگرام
- آدرس پیش‌فرض: `https://arz.appwordpresss.ir/all.php`
- معمولاً به فایل `all.php` اشاره می‌کند

#### 🔗 آدرس میانجی وب‌هوک (اختیاری)
- برای تنظیم وب‌هوک از طریق میانجی
- معمولاً به فایل `tibin.php` اشاره می‌کند
- اگر خالی باشد، از آدرس پروکسی ارسال استفاده می‌شود

### گام 3: تکمیل سایر فیلدها
- **شناسه چت گروه تلگرام**: شناسه گروه یا کانال مقصد
- **توکن ربات تلگرام**: توکن دریافتی از BotFather
- **آدرس وب‌هوک ربات**: 
  - برای **هاست خارجی**: `https://yoursite.com/wp-json/faraz/v1/handle/`
  - برای **هاست ایرانی**: همان آدرس بالا (تلگرام از طریق میانجی به این آدرس متصل می‌شود)

### گام 4: ذخیره تنظیمات
پس از کلیک روی "ذخیره تنظیمات"، وب‌هوک به صورت خودکار تنظیم می‌شود.

## ابزارهای مدیریت وب‌هوک

### 🔍 بررسی وضعیت وب‌هوک
- نمایش اطلاعات کامل وب‌هوک فعلی
- فقط برای هاست خارجی در دسترس است

### 🗑️ حذف وب‌هوک
- حذف کامل وب‌هوک از تلگرام
- فقط برای هاست خارجی در دسترس است

### 📤 تست ارسال پیام
- ارسال پیام تست برای بررسی اتصال
- برای هر دو نوع هاست قابل استفاده

## تفاوت فایل‌های پروکسی

### 📄 all.php
- **هدف**: ارسال پیام‌های خروجی به تلگرام
- **کاربرد**: وقتی افزونه می‌خواهد پیام بفرستد
- **مسیر داده**: WordPress → all.php → Telegram API

### 📄 tibin.php  
- **هدف**: میانجی برای دریافت و هدایت پیام‌ها
- **کاربرد**: تنظیم وب‌هوک و هدایت پیام‌های ورودی
- **مسیر داده**: Telegram → tibin.php → WordPress

## نکات مهم

### برای هاست ایرانی:
- **آدرس پروکسی ارسال**: حتماً باید تنظیم شود (all.php)
- **آدرس میانجی وب‌هوک**: اختیاری است (tibin.php)
- بررسی مستقیم وضعیت وب‌هوک امکان‌پذیر نیست
- حذف وب‌هوک باید از طریق مدیر پروکسی انجام شود

### برای هاست خارجی:
- **هیچ نیازی به پروکسی یا واسطه نیست**
- تمام عملیات مستقیماً با API تلگرام انجام می‌شود
- سرعت بالاتر (بدون لایه اضافی)
- امکان بررسی کامل وضعیت وب‌هوک
- کنترل کامل بر روی وب‌هوک

## ⚠️ نکته مهم

### چرا برای هاست خارجی از all.php استفاده نکنیم؟
- **غیرضروری**: تلگرام مستقیماً در دسترس است
- **کندتر**: اضافه کردن یک لایه واسطه
- **پیچیده‌تر**: بدون مزیت اضافی
- **بهتر**: استفاده مستقیم از `wp_remote_post()`

## عیب‌یابی

### مشکلات رایج:

1. **خطای "توکن نامعتبر"**
   - بررسی صحت توکن ربات
   - اطمینان از فعال بودن ربات

2. **عدم دریافت پیام‌ها**
   - بررسی صحت آدرس وب‌هوک
   - تست ارسال پیام برای بررسی اتصال

3. **خطای پروکسی (هاست ایرانی)**
   - بررسی در دسترس بودن آدرس پروکسی
   - تماس با مدیر پروکسی

### لاگ‌ها:
تمام فعالیت‌ها در فایل `telegram_logs.txt` ثبت می‌شوند.

## پشتیبانی

برای دریافت پشتیبانی:
- بررسی لاگ‌های افزونه
- ارسال جزئیات خطا به تیم پشتیبانی